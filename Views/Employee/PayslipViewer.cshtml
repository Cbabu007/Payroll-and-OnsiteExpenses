@{
    Layout = "~/Views/Employee/EmployeeLayout.cshtml";
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>ABC Construction</title>
    <link rel="stylesheet" href="~/css/site.css" />
    <style>
        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        .main-container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .sidebar {
            width: 264px;
            background-color: #0990F0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
            height: 100vh;
            flex-shrink: 0;
        }

        .side-btn {
            width: 100%;
            height: 83px;
            background-color: #0990F0;
            color: white;
            font-weight: bold;
            font-size: 18px;
            border: none;
            cursor: pointer;
        }

            .side-btn:hover {
                background-color: #066AC0;
            }

        .right-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: white;
            height: 100vh;
            overflow: hidden;
        }

        .header {
            height: 140px;
            background-color: #0990F0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            margin: 0;
            width: 100%;
            flex-shrink: 0;
        }

            .header h1 {
                font-size: 2.5rem;
                color: white;
                margin: 0;
            }

        .content-frame {
            flex: 1;
            background-color: white;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            width: 100%;
        }

        .form-container {
            border: 2px solid black;
            border-radius: 40px;
            width: 95%;
            max-width: 800px;
            padding: 30px;
            background-color: #fff;
        }

        .row {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .photo-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 200px;
        }

        .photo-box {
            width: 150px;
            height: 150px;
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
            border: 1px solid #ccc;
        }

            .photo-box img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                border-radius: 10px;
            }

        .form-fields {
            flex: 1 1 300px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        input[type="text"],
        input[type="date"],
        input[type="email"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #000;
        }

        .btn-row {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 25px;
            background-color: red;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        .col {
            display: flex;
            flex-direction: column;
        }

        .flex-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 20px;
        }

        table {
            width: 95%;
            max-width: 800px;
            border-collapse: collapse;
            margin-top: 40px;
            background-color: white;
        }

        th, td {
            border: 2px solid black;
            padding: 12px;
            text-align: center;
            font-size: 16px;
        }

        th {
            background-color: #0990F0;
            color: white;
            font-weight: bold;
        }

        td {
            background-color: #f9f9f9;
        }
    </style>

    <script>
        function showSection(sectionId) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }
    </script>
</head>
<body>
   
            <div class="content-frame">
                <h2 style="margin-top: 20px;">Payslip Viewer</h2>
                <div class="form-container">
                    <div class="form-header">
                        <div class="form-group">
                            <label for="employeeSelect">Select Employee ID</label>
                            <select id="employeeSelect" class="form-control" required>
                                <option value="">-- Select Employee ID --</option>
                            </select>
                        </div>
                        <div>
                            <label for="month">Month</label>
                            <select id="month">
                                <option value="">Select</option>
                                <option>January</option>
                                <option>February</option>
                                <option>March</option>
                                <option>April</option>
                                <option>May</option>
                                <option>June</option>
                                <option>July</option>
                                <option>August</option>
                                <option>September</option>
                                <option>October</option>
                                <option>November</option>
                                <option>December</option>
                            </select>
                        </div>
                        <div>
                            <label for="year">Year</label>
                            <select id="year">
                                <option value="">Select</option>
                                <option>2023</option>
                                <option>2024</option>
                                <option>2025</option>
                            </select>
                        </div>
                    </div>



                    <div class="btn-row">
                        <button class="btn" onclick="generatePayrollReport()">Download PDF</button>
                    </div>
                </div>



                <script>
                    sessionStorage.setItem("EmployeeID", "@ViewBag.EmployeeID");

                    window.onload = function () {
                        loadEmployeeIDs();

                        const yearSelect = document.getElementById("year");
                        const currentYear = new Date().getFullYear();

                        yearSelect.innerHTML = '<option value="">Select</option>';
                        for (let i = currentYear - 5; i <= currentYear + 5; i++) {
                            const option = document.createElement("option");
                            option.value = i;
                            option.text = i;
                            yearSelect.appendChild(option);
                        }
                    };

                    function loadEmployeeIDs() {
                        fetch("/FetchPDF/GetEmployeeIDsFromUploads")
                            .then(response => response.json())
                            .then(data => {
                                if (data.error) {
                                    console.error("Server Error:", data.error);
                                    return;
                                }

                                const select = document.getElementById("employeeSelect");
                                select.innerHTML = '<option value="">-- Select Employee ID --</option>';
                                data.forEach(id => {
                                    const option = document.createElement("option");
                                    option.value = id;
                                    option.text = id;
                                    select.appendChild(option);
                                });
                            })
                            .catch(error => {
                                console.error("Failed to load Employee IDs:", error);
                            });
                    }

                    async function generatePayrollReport() {
                        let employeeId = sessionStorage.getItem("EmployeeID");
                        if (!employeeId || employeeId === "") {
                            employeeId = document.getElementById("employeeSelect").value;
                            sessionStorage.setItem("EmployeeID", employeeId);
                        }

                        const month = document.getElementById("month").value;
                        const year = document.getElementById("year").value;

                        if (!employeeId || !month || !year) {
                            alert("Please select Employee ID, Month, and Year.");
                            return;
                        }

                        const url = `/FetchPDF/DownloadPayslip?EmployeeID=${employeeId}&Month=${encodeURIComponent(month)}&Year=${year}`;

                        try {
                            const response = await fetch(url);
                            if (!response.ok) {
                                alert("Payslip not found.");
                                return;
                            }

                            const blob = await response.blob();
                            const link = document.createElement("a");
                            link.href = window.URL.createObjectURL(blob);
                            link.download = `${employeeId}_${month}_${year}.pdf`;
                            link.click();
                        } catch (error) {
                            console.error("Download error:", error);
                            alert("An error occurred while downloading the payslip.");
                        }
                    }
                </script>
            </div>
      
</body>
</html>
