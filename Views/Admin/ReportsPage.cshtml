@{
    Layout = "~/Views/Admin/AdminLayout.cshtml";
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ABC Construction</title>
    <link rel="stylesheet" href="~/css/site.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>


    <style>
        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            font-family: Arial, sans-serif;
            overflow: hidden; 
        }

        .main-container {
            display: flex;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        .sidebar {
            width: 264px;
            height: 100vh;
            background-color: #0990F0;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
            overflow-y: auto;
            overflow-x: hidden;
            flex-shrink: 0;
        }

        .side-btn {
            width: 100%;
            height: 60px;
            background-color: #0990F0;
            color: white;
            font-weight: bold;
            border: none;
            cursor: pointer;
        }

            .side-btn:hover {
                background-color: #066AC0;
            }

        .right-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-color: #ffffff;
        }

        .header {
            height: 176px;
            width: 100%;
            background-color: #0990F0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .content-frame {
            flex: 1;
            padding: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .dashboard-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

            .dashboard-buttons button {
                padding: 12px 20px;
                border-radius: 30px;
                border: 2px solid black;
                background-color: white;
                font-weight: bold;
                cursor: pointer;
            }

        .dynamic-frame {
            width: 100%;
            height: 100%;
            border: 3px solid black;
            border-radius: 25px;
            padding: 20px;
            background-color: white;
            overflow: auto;
        }

            .dynamic-frame::-webkit-scrollbar {
                width: 8px;
            }

            .dynamic-frame::-webkit-scrollbar-thumb {
                background-color: #ccc;
                border-radius: 5px;
            }

        .section {
            display: none;
        }

            .section.active {
                display: block;
            }

       


        #section1 {
            width: 100%;
            max-width: 500px;
            padding: 20px;
            margin: 0 auto;
        }

        
        .submit-btn, .close-btn, .pdf-btn {
            display: block;
            margin: 20px auto 0;
            background-color: red;
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }

       
        #section2 .button-group {
            text-align: center;
            margin-top: 20px;
        }

        .button-container button {
            padding: 10px 20px;
            margin: 20px;
            border-radius: 20px;
            border: 2px solid black;
            background: white;
            cursor: pointer;
            font-size: 16px;
        }

       
        .form-container, .payslip-container {
            border: 2px solid black;
            border-radius: 30px;
            padding: 30px;
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
            display: none;
        }

        label {
            display: block;
            text-align: left;
            margin: 10px 0 5px;
        }

        input, select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .form-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px; 
            justify-content: space-between;
            padding: 10px 0;
        }

        .form-group {
            flex: 1 1 45%; 
            min-width: 200px;
        }

            .form-group label {
                display: block;
                margin-bottom: 6px;
                font-weight: bold;
                color: #333;
            }

            .form-group input,
            .form-group select {
                width: 100%;
                padding: 10px;
                border: 1px solid #ccc;
                border-radius: 6px;
                font-size: 14px;
                background-color: #fff;
                box-sizing: border-box;
            }

               
                .form-group input:focus,
                .form-group select:focus {
                    outline: none;
                    border-color: #00aaff;
                    box-shadow: 0 0 4px rgba(0, 170, 255, 0.3);
                }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
            width: 100%;
            box-sizing: border-box;
        }

            .form-row label {
                min-width: 120px;
                font-weight: bold;
            }

            .form-row input,
            .form-row select {
                flex: 1;
                padding: 8px;
                border-radius: 6px;
                border: 1px solid #ccc;
                min-width: 200px;
                max-width: 100%;
            }


        .skyblue-box {
            background-color: #e0f7ff;
            border: 2px solid #00aaff;
            border-radius: 10px;
            padding: 2rem;
            width: 100%;
            max-width: 1000px;
            margin: auto;
            box-shadow: 0 4px 10px rgba(0, 170, 255, 0.2);
            box-sizing: border-box;
            overflow-x: hidden;
        }

            .skyblue-box::-webkit-scrollbar {
                height: 6px;
            }

            .skyblue-box::-webkit-scrollbar-thumb {
                background-color: #ccc;
                border-radius: 4px;
            }

           
            .skyblue-box input,
            .skyblue-box select {
                max-width: 100%;
                width: 100%;
                box-sizing: border-box;
            }
            .skyblue-box h2 {
                color: #007bbd;
                font-weight: bold;
                text-align: center;
                margin-bottom: 25px;
            }

        
        .styled-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #ffffff;
            border: 1px solid #00aaff;
            box-shadow: 0 2px 5px rgba(0, 170, 255, 0.2);
            border-radius: 6px;
            overflow: hidden;
        }

            .styled-table th, .styled-table td {
                border: 1px solid #00aaff;
                padding: 10px 15px;
                text-align: center;
                font-size: 14px;
            }

            .styled-table th {
                background-color: #e0f7ff;
                color: #007bbd;
                font-weight: bold;
            }

            .styled-table td {
                background-color: #f9fcff;
            }

    </style>

    <script>
        function showSection(sectionId) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }
    </script>
</head>
<body>
   
            <div class="content-frame">
                <h2 style="margin-top: 20px;">Generate Payroll</h2>
                <div class="dashboard-buttons">
                    <button onclick="showSection('section1')">PF Registration</button>
                    <button onclick="showSection('section2')">Generate Payslip </button>
                    <button onclick="showSection('section3')">Upload Payslips</button>
                </div>





                <div class="dynamic-frame">
                    <div id="section1" class="section active">
                        <div class="skyblue-box">
                            <h2>PF Registration</h2>
                            <div class="form-group">

                                <div class="form-row">
                                    <label>Select Employee:</label>
                                    <select id="employeeId">
                                        <option value="">-- Select --</option>
                                    </select>
                                </div>

                                <div class="form-row">
                                    <label>Date of Joining:</label>
                                    <input type="date" id="dateOfJoining" class="form-control" />
                                </div>

                                <div class="form-row">
                                    <label>PF A/C Number:</label>
                                    <input type="text" id="pfNumber" class="form-control" />
                                </div>

                                <div class="form-row">
                                    <label>UAN:</label>
                                    <input type="text" id="uan" class="form-control" />
                                </div>

                                <br />

                                <div class="form-row">
                                    <button style="background-color: green; color: white; margin-right: 10px;" onclick="register()">Register</button>
                                    <button style="background-color: skyblue; color: white; margin-right: 10px;" onclick="update()">Update</button>
                                    <button style="background-color: red; color: white;" onclick="clearRecord()">Clear</button>
                                </div>
                            </div>
                        </div>


                        <div style="margin-top: 30px;">

                            <table id="pfTable" border="1" style="margin-top:20px;">
                                <table class="styled-table">
                                    <thead>
                                        <tr>
                                            <th>Employee ID</th>
                                            <th>PF A/C Number</th>
                                            <th>UAN</th>

                                        </tr>
                                    </thead>
                                    <tbody id="pfTableBody"></tbody>
                                </table>
                            </table>
                        </div>
                    </div>

                    <script>
                        function loadPFEmployees() {
                            fetch("/PFRegistration/Employees")
                                .then(res => res.json())
                                .then(data => {
                                    const select = document.getElementById("employeeId");
                                    select.innerHTML = `<option value="">-- Select --</option>`;
                                    data.forEach(emp => {
                                        const opt = document.createElement("option");
                                        opt.value = emp.employeeID;
                                        opt.textContent = `${emp.fullName} ${emp.employeeID}`;
                                        select.appendChild(opt);
                                    });
                                });
                        }

                        function loadPFTable() {
                            const empId = document.getElementById("employeeId").value;
                            fetch(`/PFRegistration/GetPFByEmployee?employeeId=${empId}`)
                                .then(res => res.json())
                                .then(data => {
                                    const tbody = document.getElementById("pfTableBody");
                                    tbody.innerHTML = "";
                                    data.forEach(row => {
                                        tbody.innerHTML += `
                                                <tr>
                                                                        <td>${row.employeeID}</td>
                                                    <td>${row.pfAcNumber}</td>
                                                    <td>${row.uan}</td>

                                                </tr>
                                            `;
                                    });
                                });
                        }

                        function register() {
                            const data = {
                                EmployeeID: document.getElementById("employeeId").value,
                                DateOfJoining: document.getElementById("dateOfJoining").value,
                                PFAcNumber: document.getElementById("pfNumber").value,
                                UAN: document.getElementById("uan").value
                            };

                            console.log("Submitting:", data); 

                            fetch("/PFRegistration/Register", {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify(data)
                            })
                                .then(res => res.json())
                                .then(data => {
                                    alert(data.message);
                                    loadPFTable();
                                })
                                .catch(err => {
                                    console.error("❌ Error in register():", err);
                                    alert("❌ Register failed. See console.");
                                });
                        }


                        function update() {
                            const data = {
                                EmployeeID: document.getElementById("employeeId").value,
                                DateOfJoining: document.getElementById("dateOfJoining").value,
                                PFAcNumber: document.getElementById("pfNumber").value,
                                UAN: document.getElementById("uan").value
                            };

                            fetch("/PFRegistration/Update", {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify(data)
                            }).then(res => res.json()).then(data => {
                                alert(data.message);
                                loadPFTable();
                            });
                        }

                        function clearRecord() {
                            const data = {
                                EmployeeID: document.getElementById("employeeId").value
                            };

                            if (!confirm("Are you sure you want to delete this record?")) return;

                            fetch("/PFRegistration/Clear", {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify(data)
                            })
                                .then(res => res.json())
                                .then(data => {
                                    alert(data.message);
                                    if (data.success) {
                                       
                                        document.getElementById("pfNumber").value = "";
                                        document.getElementById("uan").value = "";

                                        
                                        loadPFTable();
                                    }
                                })
                                .catch(err => alert("Delete error: " + err.message));
                        }


                        function deletePF(id) {
                            if (confirm("Are you sure you want to delete this record?")) {
                                fetch("/PFRegistration/DeleteById", {
                                    method: "POST",
                                    headers: { "Content-Type": "application/json" },
                                    body: JSON.stringify(id) 
                                }).then(res => res.json()).then(data => {
                                    if (data.success) {
                                        alert("Deleted successfully.");
                                        loadPFTable();
                                    } else {
                                        alert("Delete failed: " + data.message);
                                    }
                                });
                            }
                        }


                        function editPF(pfNumber, uan) {
                            document.getElementById("pfNumber").value = pfNumber;
                            document.getElementById("uan").value = uan;
                        }

                        document.getElementById("employeeId").addEventListener("change", loadPFTable);
                        window.onload = loadEmployees;
                    </script>

                    <style>
                        .centered-section {
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            flex-direction: column;
                            padding: 40px 0;
                            .form-wrapper

                        }
                    </style>

                    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
                    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

                    <div id="section2" class="section">
                        <div class="skyblue-box">
                            <h2>Generate Payslip</h2>
                            <div class="container mt-4">
                                <h4 class="mb-3">Payslip Generation</h4>
                                <div class="d-flex" style="gap: 20px; align-items: flex-start;">
                                    
                                    <div style="width: 40%;">
                                        <div class="form-group border p-3 rounded" style="border: 2px solid #ccc;">

                                            <h5 class="mb-3">Generate Payslip</h5>
                                            <div class="form-group">
                                                <label for="empSelect">Select Employee ID</label>
                                                <select class="form-control" id="empSelect">
                                                    <option value="">-- Select --</option>
                                                </select>
                                            </div>

                                            <div class="form-group">
                                                <label for="monthSelect">Select Month</label>
                                                <select class="form-control" id="monthSelect">
                                                    <option value="">-- Month --</option>
                                                    <option>January</option>
                                                    <option>February</option>
                                                    <option>March</option>
                                                    <option>April</option>
                                                    <option>May</option>
                                                    <option>June</option>
                                                    <option>July</option>
                                                    <option>August</option>
                                                    <option>September</option>
                                                    <option>October</option>
                                                    <option>November</option>
                                                    <option>December</option>
                                                </select>
                                            </div>

                                            <div class="form-group">
                                                <label for="yearSelect">Select Year</label>
                                                <select class="form-control" id="yearSelect">
                                                    <option value="">-- Year --</option>
                                                </select>
                                            </div>

                                            <div class="mt-3">
                                                <button class="btn btn-primary w-100 mb-2" onclick="fetchPayslip()">OK</button>
                                                <button class="btn btn-secondary w-100" onclick="loadEmployeeIDs()">Refresh</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- RIGHT: Table -->
                                <div style="width: 100%; overflow-x: auto;">

                                    <table id="payslipTable" class="table table-bordered" style="display: none; min-width: 1000px;">
                                        <table class="styled-table">
                                            <thead class="thead-dark">
                                                <tr>
                                                    <th>Employee ID</th>
                                                    <th>Name</th>
                                                    <th>Designation</th>
                                                    <th>Date of Joining</th>
                                                    <th>PF A/C</th>
                                                    <th>UAN</th>
                                                    <th>LOP Days</th>
                                                    <th>Basic Salary</th>
                                                    <th>HRA</th>
                                                    <th>Conveyance</th>
                                                    <th>Gross</th>
                                                    <th>EPF</th>
                                                    <th>Health</th>
                                                    <th>Total Deduction</th>
                                                    <th>Net Pay</th>
                                                </tr>
                                            </thead>
                                            <tbody id="payslipBody"></tbody>
                                        </table>
                                    </table>
                                    <script>
                                        
                                        for (let y = 2022; y <= new Date().getFullYear(); y++) {
                                            document.getElementById("yearSelect").innerHTML += `<option>${y}</option>`;
                                        }

                                       
                                        function loadEmployeeIDs() {
                                            fetch("/ReportsPage/FetchEmployee/GetAllEmployeeIDs")
                                                .then(res => res.json())
                                                .then(data => {
                                                    const dropdown = document.getElementById("empSelect");
                                                    dropdown.innerHTML = `<option value="">-- Select --</option>`;
                                                    data.forEach(emp => {
                                                        dropdown.innerHTML += `<option value="${emp.employeeID}">${emp.employeeID}</option>`;
                                                    });
                                                });
                                        }

                                        
                                        function fetchPayslip() {
                                            const empID = document.getElementById("empSelect").value;
                                            const month = document.getElementById("monthSelect").value;
                                            const year = document.getElementById("yearSelect").value;
                                            if (!empID || !month || !year) return alert("Select all fields");

                                            fetch(`/ReportsPage/FetchEmployee/GetPayslipDetails?employeeID=${empID}&month=${month}&year=${year}`)
                                                .then(res => res.json())
                                                .then(data => {
                                                    
                                                    const row = `
                                                        <tr>
                                                            <td>${data.employeeID}</td>
                                                            <td>${data.employeeName}</td>
                                                            <td>${data.designation}</td>
                                                            <td>${data.dateOfJoining}</td>
                                                            <td>${data.pfAccountNumber}</td>
                                                            <td>${data.uan}</td>
                                                            <td>${data.lopDays}</td>
                                                            <td>${data.basicSalary}</td>
                                                            <td>${data.hra}</td>
                                                            <td>${data.conveyanceAllowance}</td>
                                                            <td>${data.grossEarnings}</td>
                                                            <td>${data.epfContribution}</td>
                                                            <td>${data.healthInsurance}</td>
                                                            <td>${data.totalDeductions}</td>
                                                            <td>${data.totalNetPayable}</td>
                                                        </tr>
                                                    `;
                                                    document.getElementById("payslipBody").innerHTML = row;
                                                    document.getElementById("payslipTable").style.display = "table";

                                                    
                                                    document.getElementById("EmployeeID").value = data.employeeID || "";
                                                    document.getElementById("EmployeeName").value = data.employeeName || "";
                                                    document.getElementById("Designation").value = data.designation || "";
                                                    document.getElementById("DateofJoining").value = data.dateOfJoining || "";
                                                    document.getElementById("LOPDays").value = data.lopDays || "";
                                                    document.getElementById("PFAcNumber").value = data.pfAccountNumber || "";
                                                    document.getElementById("UAN").value = data.uan || "";
                                                    document.getElementById("BasicSalary").value = data.basicSalary || "";
                                                    document.getElementById("HouseRentAllowance").value = data.hra || "";
                                                    document.getElementById("ConveyanceAllowance").value = data.conveyanceAllowance || "";
                                                    document.getElementById("GrossEarnings").value = data.grossEarnings || "";
                                                    document.getElementById("EPFContribution").value = data.epfContribution || "";
                                                    document.getElementById("HealthInsurance").value = data.healthInsurance || "";
                                                    document.getElementById("TotalDeducation").value = data.totalDeductions || "";
                                                    document.getElementById("TotalNetPayable").value = data.totalNetPayable || "";

                                                    
                                                    document.getElementById("PayPeriod").value = month + " " + year;
                                                    
                                                });
                                        }

                                        
                                        loadEmployeeIDs();
                                    </script>
                                </div>
                            </div>

                            <form id="payslipForm" enctype="multipart/form-data">
                                <div class="skyblue-box">
                                    <div class="form-row mb-2">

                                        <div class="col-md-4">
                                            <label for="EmployeeID">Employee ID</label>
                                            <input type="text" class="form-control" id="EmployeeID" name="EmployeeID" required />
                                        </div>
                                        <div class="col-md-4">
                                            <label for="EmployeeName">Employee Name</label>
                                            <input type="text" class="form-control" id="EmployeeName" name="EmployeeName" />
                                        </div>
                                        <div class="col-md-4">
                                            <label for="Designation">Designation</label>
                                            <input type="text" class="form-control" id="Designation" name="Designation" />

                                        </div>

                                        <div class="form-row mb-2">
                                            <div class="col-md-4">
                                                <label for="PayPeriod">Pay Period</label>
                                                <input type="text" class="form-control" id="PayPeriod" name="PayPeriod" placeholder="e.g., March 2025" />
                                            </div>
                                            <div class="col-md-4">
                                                <label for="DateofJoining">Date of Joining</label>
                                                <input type="text" class="form-control" id="DateofJoining" name="DateofJoining" />
                                            </div>
                                            <div class="col-md-4">
                                                <label for="PayDate">Pay Date</label>
                                                <input type="date" class="form-control" id="PayDate" name="PayDate" />
                                            </div>
                                        </div>

                                        <div class="form-row mb-2">
                                            <div class="col-md-4">
                                                <label for="PaidDays">Paid Days</label>
                                                <input type="number" class="form-control" id="PaidDays" name="PaidDays" />
                                            </div>
                                            <div class="col-md-4">
                                                <label for="LOPDays">LOP Days</label>
                                                <input type="number" class="form-control" id="LOPDays" name="LOPDays" />
                                            </div>
                                            <div class="col-md-4">
                                                <label for="PFAcNumber">PF A/C Number</label>
                                                <input type="text" class="form-control" id="PFAcNumber" name="PFAcNumber" />
                                            </div>
                                        </div>

                                        <div class="form-row mb-2">
                                            <div class="col-md-4">
                                                <label for="UAN">UAN</label>
                                                <input type="text" class="form-control" id="UAN" name="UAN" />
                                            </div>
                                            <div class="col-md-4">
                                                <label for="BasicSalary">Basic Salary</label>
                                                <input type="number" class="form-control" id="BasicSalary" name="BasicSalary" />
                                            </div>
                                            <div class="col-md-4">
                                                <label for="HouseRentAllowance">House Rent Allowance</label>
                                                <input type="number" class="form-control" id="HouseRentAllowance" name="HouseRentAllowance" />
                                            </div>
                                        </div>

                                        <div class="form-row mb-2">
                                            <div class="col-md-4">
                                                <label for="ConveyanceAllowance">Conveyance Allowance</label>
                                                <input type="number" class="form-control" id="ConveyanceAllowance" name="ConveyanceAllowance" />
                                            </div>
                                            <div class="col-md-4">
                                                <label for="GrossEarnings">Gross Earnings</label>
                                                <input type="number" class="form-control" id="GrossEarnings" name="GrossEarnings" />
                                            </div>
                                            <div class="col-md-4">
                                                <label for="EPFContribution">EPF Contribution</label>
                                                <input type="number" class="form-control" id="EPFContribution" name="EPFContribution" />
                                            </div>
                                        </div>

                                        <div class="form-row mb-2">
                                            <div class="col-md-4">
                                                <label for="HealthInsurance">Health Insurance</label>
                                                <input type="number" class="form-control" id="HealthInsurance" name="HealthInsurance" />
                                            </div>
                                            <div class="col-md-4">
                                                <label for="TotalDeducation">Total Deductions</label>
                                                <input type="number" class="form-control" id="TotalDeducation" name="TotalDeducation" />
                                            </div>
                                            <div class="col-md-4">
                                                <label for="TotalNetPayable">Total Net Payable</label>
                                                <input type="number" class="form-control" id="TotalNetPayable" name="TotalNetPayable" />
                                            </div>
                                        </div>

                                        <div class="form-row mb-3">
                                            <div class="col-md-6">
                                                <label for="IssuedBy">Issued By (Signature Upload)</label>
                                                <input type="file" class="form-control" id="IssuedBy" name="IssuedBy" accept="image/*" />
                                            </div>
                                        </div>


                                        <button type="button" class="btn btn-primary" onclick="generatePayslipPDF()">Download PDF</button>
                                    </div>
                                </div>

                            </form>

                            <script>
                                window.onload = function () {
                                    fetch('/ReportsPage/TableGenerate/GetEmployeeDropdown')
                                        .then(res => res.json())
                                        .then(data => {
                                            const select = document.getElementById("EmployeeID");
                                            select.innerHTML = `<option value="">-- Select --</option>`;
                                            data.forEach(emp => {
                                                const opt = document.createElement("option");
                                                opt.value = emp.employeeID;
                                                opt.textContent = emp.fullName;
                                                select.appendChild(opt);
                                            });
                                        });

                                    document.getElementById("EmployeeID").addEventListener("change", function () {
                                        const empId = this.value;
                                        if (!empId) return;

                                        fetch(`/ReportsPage/TableGenerate/GetEmployeeFullDetails?employeeID=${empId}`)
                                            .then(res => res.json())
                                            .then(data => {
                                                document.getElementById("empIDCell").innerText = empId;
                                                document.getElementById("empNameCell").innerText = data.employeeName;
                                                document.getElementById("designationCell").innerText = data.designation;
                                                document.getElementById("dojCell").innerText = data.dateOfJoining?.split('T')[0];
                                                document.getElementById("lopCell").innerText = data.lopDays;
                                                document.getElementById("pfCell").innerText = data.pfAcNumber;
                                                document.getElementById("uanCell").innerText = data.uan;
                                                document.getElementById("basicCell").innerText = data.basicSalary;
                                                document.getElementById("hraCell").innerText = data.houseRentAllowance;
                                                document.getElementById("foodCell").innerText = data.food;
                                                document.getElementById("travelCell").innerText = data.travel;
                                                document.getElementById("accomCell").innerText = data.accommodation;
                                            });
                                    });
                                };
                            </script>



                        </div>

                        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
                        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>


                        <div id="payslip-preview" class="p-4" style="display:none; width:800px; font-family:Arial;">
                            <div style="display:flex; justify-content:space-between; align-items:flex-start; border-bottom:2px solid #000; padding-bottom:10px;">
                                <div>
                                    <h3>ABC Construction</h3>
                                    <p>Tamil Nadu, India</p>
                                </div>
                                <div>
                                    <strong>Payslip For the Month</strong><br />
                                    <span id="previewPayPeriod"></span>
                                </div>
                            </div>

                            <table style="width:100%; margin-top:10px;">
                                <tr>
                                    <td><strong>Employee Name:</strong> <span id="previewName"></span></td>
                                    <td><strong>Designation:</strong> <span id="previewDesignation"></span></td>
                                </tr>
                                <tr>
                                    <td><strong>Employee ID:</strong> <span id="previewEmpID"></span></td>
                                    <td><strong>Date of Joining:</strong> <span id="previewDOJ"></span></td>
                                </tr>
                                <tr>
                                    <td><strong>Pay Period:</strong> <span id="previewPeriod"></span></td>
                                    <td><strong>Pay Date:</strong> <span id="previewPayDate"></span></td>
                                </tr>
                            </table>

                            <div style="margin-top:20px; display:flex; justify-content:space-between; background:#e0ffe0; padding:10px;">
                                <div>
                                    <h4>₹ <span id="previewNetPay"></span></h4>
                                    <small>Employee Net Pay</small>
                                </div>
                                <div>
                                    <p><strong>Paid Days:</strong> <span id="previewPaidDays"></span></p>
                                    <p><strong>LOP Days:</strong> <span id="previewLOP"></span></p>
                                </div>
                            </div>

                            <div style="margin-top:10px;">
                                <strong>PF A/C Number:</strong> <span id="previewPF"></span> |
                                <strong>UAN:</strong> <span id="previewUAN"></span>
                            </div>

                            <div style="display:flex; justify-content:space-between; margin-top:20px;">
                                <table style="width:48%; border-collapse:collapse;" border="1">
                                    <thead><tr><th colspan="2">EARNINGS</th></tr></thead>
                                    <tbody>
                                        <tr><td>Basic</td><td><span id="previewBasic"></span></td></tr>
                                        <tr><td>House Rent Allowance</td><td><span id="previewHRA"></span></td></tr>
                                        <tr><td>Conveyance Allowance</td><td><span id="previewConveyance"></span></td></tr>
                                        <tr><td><strong>Gross Earnings</strong></td><td><strong><span id="previewGross"></span></strong></td></tr>
                                    </tbody>
                                </table>

                                <table style="width:48%; border-collapse:collapse;" border="1">
                                    <thead><tr><th colspan="2">DEDUCTIONS</th></tr></thead>
                                    <tbody>
                                        <tr><td>EPF Contribution</td><td><span id="previewEPF"></span></td></tr>
                                        <tr><td>Health Insurance</td><td><span id="previewHI"></span></td></tr>
                                        <tr><td><strong>Total Deductions</strong></td><td><strong><span id="previewTotalDeduction"></span></strong></td></tr>
                                    </tbody>
                                </table>
                            </div>

                            <div style="margin-top:20px; text-align:center;">
                                <h4>TOTAL NET PAYABLE: ₹ <span id="previewNet"></span></h4>
                                <p><em>In Words: <span id="previewInWords"></span></em></p>
                            </div>

                            <div style="text-align:right; margin-top:30px;">
                                <p>Issued By:</p>
                                <img id="previewSignature" src="" alt="signature" style="height:50px;" />
                            </div>
                        </div>

                    </div>




                    <script>
                        window.onload = function () {
                            loadPFEmployees();
                            loadPayslipEmployees();
                        };
                    </script>

                    <script>

                            document.addEventListener('DOMContentLoaded', function () {
                                
                                fetch('/ReportsPage/PayslipGenerateController/GetAllEmployees')
                                    .then(res => res.json())
                                    .then(data => {
                                        const dropdown = document.getElementById('EmployeeID');
                                        dropdown.innerHTML = '<option value="">-- Select Employee --</option>';
                                        data.forEach(emp => {
                                            const option = document.createElement('option');
                                            option.value = emp.employeeID;
                                            option.textContent = emp.fullName;
                                            dropdown.appendChild(option);
                                        });
                                    });

                                
                                document.getElementById('EmployeeID').addEventListener('change', function () {
                                    const empId = this.value;
                                    if (!empId) return;

                                    fetch(`/ReportsPage/PayslipGenerateController/GetEmployeeDetails?employeeID=${empId}`)
                                        .then(res => res.json())
                                        .then(data => {
                                            document.getElementById('EmployeeName').value = data.employeeName;
                                            document.getElementById('Designation').value = data.designation;
                                            document.getElementById('DateofJoining').value = data.dateofJoining;
                                            document.getElementById('LOPDays').value = data.lopDays;
                                            document.getElementById('PFAcNumber').value = data.pfAcNumber;
                                            document.getElementById('UAN').value = data.uan;
                                            document.getElementById('BasicSalary').value = data.basicSalary;
                                            document.getElementById('HouseRentAllowance').value = data.houseRentAllowance;
                                            document.getElementById('ConveyanceAllowance').value = data.conveyanceAllowance;
                                            document.getElementById('GrossEarnings').value = data.grossEarnings;
                                            document.getElementById('EPFContribution').value = data.epfContribution;

                                            
                                            document.getElementById('HealthInsurance').value = '';
                                            document.getElementById('TotalDeducation').value = '';
                                            document.getElementById('TotalNetPayable').value = '';
                                        });
                                });
                           
                                document.getElementById('HealthInsurance').addEventListener('input', () => {
                                    const gross = parseFloat(document.getElementById('GrossEarnings').value) || 0;
                                    const epf = parseFloat(document.getElementById('EPFContribution').value) || 0;
                                    const hi = parseFloat(document.getElementById('HealthInsurance').value) || 0;
                                    const totalDeduction = epf + hi;

                                    document.getElementById('TotalDeducation').value = totalDeduction.toFixed(2);
                                    document.getElementById('TotalNetPayable').value = (gross - totalDeduction).toFixed(2);
                                });
                            });

                        function generatePayslip() {
                            const form = document.getElementById('payslipForm');
                            const formData = new FormData(form);

                            fetch('/ReportsPage/PayslipGenerateConstroller/SubmitPayslip', {
                                method: 'POST',
                                body: formData
                            })
                                .then(res => res.json())
                                .then(data => {
                                    if (data.success) {
                                        alert(data.message);
                                        form.reset();
                                    } else {
                                        alert("Something went wrong!");
                                    }
                                })
                                .catch(err => {
                                    console.error("Error:", err);
                                    alert("Error submitting form.");
                                });
                        }

                        function generatePayslipPDF() {
                            document.getElementById('previewName').innerText = document.getElementById('EmployeeName').value;
                            document.getElementById('previewDesignation').innerText = document.getElementById('Designation').value;
                            document.getElementById('previewEmpID').innerText = document.getElementById('EmployeeID').value;
                            document.getElementById('previewDOJ').innerText = document.getElementById('DateofJoining').value;
                            document.getElementById('previewPeriod').innerText = document.getElementById('PayPeriod').value;
                            document.getElementById('previewPayDate').innerText = document.getElementById('PayDate').value;
                            document.getElementById('previewPayPeriod').innerText = document.getElementById('PayPeriod').value;

                            document.getElementById('previewPaidDays').innerText = document.getElementById('PaidDays').value;
                            document.getElementById('previewLOP').innerText = document.getElementById('LOPDays').value;
                            document.getElementById('previewPF').innerText = document.getElementById('PFAcNumber').value;
                            document.getElementById('previewUAN').innerText = document.getElementById('UAN').value;

                            document.getElementById('previewBasic').innerText = document.getElementById('BasicSalary').value;
                            document.getElementById('previewHRA').innerText = document.getElementById('HouseRentAllowance').value;
                            document.getElementById('previewConveyance').innerText = document.getElementById('ConveyanceAllowance').value;
                            document.getElementById('previewGross').innerText = document.getElementById('GrossEarnings').value;

                            document.getElementById('previewEPF').innerText = document.getElementById('EPFContribution').value;
                            document.getElementById('previewHI').innerText = document.getElementById('HealthInsurance').value;
                            document.getElementById('previewTotalDeduction').innerText = document.getElementById('TotalDeducation').value;

                            const net = document.getElementById('TotalNetPayable').value;
                            document.getElementById('previewNetPay').innerText = net;
                            document.getElementById('previewNet').innerText = net;

                            document.getElementById('previewInWords').innerText = convertToWords(net);

                            const fileInput = document.getElementById('IssuedBy');
                            if (fileInput.files.length > 0) {
                                const reader = new FileReader();
                                reader.onload = function (e) {
                                    document.getElementById('previewSignature').src = e.target.result;
                                    downloadPDF();
                                };
                                reader.readAsDataURL(fileInput.files[0]);
                            } else {
                                document.getElementById('previewSignature').src = "";
                                downloadPDF();
                            }
                        }

                        function downloadPDF() {
                            const preview = document.getElementById('payslip-preview');
                            preview.style.display = 'block';

                            html2canvas(preview).then(canvas => {
                                const imgData = canvas.toDataURL('image/png');
                                const pdf = new jspdf.jsPDF('p', 'pt', 'a4');
                                pdf.addImage(imgData, 'PNG', 20, 20, 550, 0);
                                pdf.save("Payslip.pdf");
                                preview.style.display = 'none';
                            });
                        }

                        function convertToWords(num) {
                            const a = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Ten",
                                "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen",
                                "Eighteen", "Nineteen"];
                            const b = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];

                            const n = parseInt(num);
                            if (n === 0) return "Zero";

                            if (n < 20) return `Rupees ${a[n]} Only`;
                            if (n < 100) return `Rupees ${b[Math.floor(n / 10)]} ${a[n % 10]} Only`;
                            if (n < 1000) return `Rupees ${a[Math.floor(n / 100)]} Hundred ${convertToWords(n % 100)} Only`;
                            if (n < 100000) return `Rupees ${convertToWords(Math.floor(n / 1000))} Thousand ${convertToWords(n % 1000)} Only`;
                            if (n < 10000000) return `Rupees ${convertToWords(Math.floor(n / 100000))} Lakh ${convertToWords(n % 100000)} Only`;

                            return "Amount too large";
                        }
                    </script>

                    <div id="section3" class="section">
                        <h3>Upload Payslip</h3>
                        <div class="form-box">
                            <div class="form-row">
                                <style>

                                </style>

                                <div class="center-container">
                                    <div class="skyblue-box">
                                        <form id="uploadForm" enctype="multipart/form-data">
                                            <div class="row">
                                                <label for="employeeIdInput">Employee ID:</label>
                                                <input type="text" id="employeeIdInput" name="EmployeeID" class="form-control" placeholder="EMP1234" required style="width: 250px;">
                                            </div>

                                            <div class="row">
                                                <label for="monthSelect">Select Month:</label>
                                                <select id="monthSelect" name="Month" class="form-control" required style="width: 250px;">
                                                    <option value="">-- Select Month --</option>
                                                    <option>January</option>
                                                    <option>February</option>
                                                    <option>March</option>
                                                    <option>April</option>
                                                    <option>May</option>
                                                    <option>June</option>
                                                    <option>July</option>
                                                    <option>August</option>
                                                    <option>September</option>
                                                    <option>October</option>
                                                    <option>November</option>
                                                    <option>December</option>
                                                </select>
                                            </div>

                                            <div class="row">
                                                <label for="yearInput">Enter Year:</label>
                                                <input type="text" id="yearInput" name="Year" class="form-control" placeholder="e.g., 2024" required style="width: 250px;">
                                            </div>

                                            <div class="row">
                                                <label for="pdfFile">Upload PDF:</label>
                                                <input type="file" id="pdfFile" name="PdfFile" class="form-control" accept="application/pdf" required style="width: 250px;">
                                            </div>

                                            <div class="row">

                                                <button type="submit" style="width: 250px; padding: 6px 14px; font-size: 14px; background-color: #0990F0; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                                    Upload
                                                </button>


                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <script>
                                document.getElementById("uploadForm").addEventListener("submit", function (e) {
                                    e.preventDefault();

                                    const formData = new FormData(this);

                                    fetch("/ReportsPage/UploadPDF/UploadPayslip", {
                                        method: "POST",
                                        body: formData
                                    })
                                    .then(res => res.json())
                                    .then(data => {
                                        if (data.success) {
                                            alert("✅ " + data.message);
                                            document.getElementById("uploadForm").reset();
                                        } else {
                                            alert("❌ " + data.message);
                                        }
                                    })
                                    .catch(err => alert("❌ Upload Error: " + err));
                                });
                            </script>
                        </div>
                    </div>
                </div>
            </div>      
       
</body>
</html>